<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 7 Use R for mediation | SEM and R</title>
  <meta name="description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.16 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 7 Use R for mediation | SEM and R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 7 Use R for mediation | SEM and R" />
  
  <meta name="twitter:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  

<meta name="author" content="Bill" />


<meta name="date" content="2021-05-16" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="poisson-regression.html"/>

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">SEM and R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> SEM and R</a></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introduction</a><ul>
<li class="chapter" data-level="2.1" data-path="intro.html"><a href="intro.html#definitions-basic-concepts"><i class="fa fa-check"></i><b>2.1</b> Definitions (Basic Concepts)</a><ul>
<li class="chapter" data-level="2.1.1" data-path="intro.html"><a href="intro.html#observed-variable"><i class="fa fa-check"></i><b>2.1.1</b> Observed variable</a></li>
<li class="chapter" data-level="2.1.2" data-path="intro.html"><a href="intro.html#latent-variable"><i class="fa fa-check"></i><b>2.1.2</b> Latent variable</a></li>
<li class="chapter" data-level="2.1.3" data-path="intro.html"><a href="intro.html#exogenous-variable"><i class="fa fa-check"></i><b>2.1.3</b> Exogenous variable</a></li>
<li class="chapter" data-level="2.1.4" data-path="intro.html"><a href="intro.html#endogenous-variable"><i class="fa fa-check"></i><b>2.1.4</b> Endogenous variable</a></li>
<li class="chapter" data-level="2.1.5" data-path="intro.html"><a href="intro.html#measurement-model"><i class="fa fa-check"></i><b>2.1.5</b> Measurement model</a></li>
<li class="chapter" data-level="2.1.6" data-path="intro.html"><a href="intro.html#indicator-in-a-measurement-model"><i class="fa fa-check"></i><b>2.1.6</b> Indicator (in a measurement model)</a></li>
<li class="chapter" data-level="2.1.7" data-path="intro.html"><a href="intro.html#factor"><i class="fa fa-check"></i><b>2.1.7</b> Factor</a></li>
<li class="chapter" data-level="2.1.8" data-path="intro.html"><a href="intro.html#loading"><i class="fa fa-check"></i><b>2.1.8</b> Loading</a></li>
<li class="chapter" data-level="2.1.9" data-path="intro.html"><a href="intro.html#structural-model"><i class="fa fa-check"></i><b>2.1.9</b> Structural model</a></li>
<li class="chapter" data-level="2.1.10" data-path="intro.html"><a href="intro.html#regerssion-path"><i class="fa fa-check"></i><b>2.1.10</b> Regerssion path</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="intro.html"><a href="intro.html#the-path-diagram"><i class="fa fa-check"></i><b>2.2</b> The path diagram</a></li>
<li class="chapter" data-level="2.3" data-path="intro.html"><a href="intro.html#lavaan-syntax"><i class="fa fa-check"></i><b>2.3</b> Lavaan syntax</a></li>
<li class="chapter" data-level="2.4" data-path="intro.html"><a href="intro.html#regression-and-path-analysis"><i class="fa fa-check"></i><b>2.4</b> Regression and path analysis</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="real-data-example-simple-linear-regression.html"><a href="real-data-example-simple-linear-regression.html"><i class="fa fa-check"></i><b>3</b> Real data example (Simple linear regression)</a><ul>
<li class="chapter" data-level="3.1" data-path="real-data-example-simple-linear-regression.html"><a href="real-data-example-simple-linear-regression.html#read-the-data-into-the-r-studio-environment."><i class="fa fa-check"></i><b>3.1</b> Read the data into the R Studio environment.</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="real-data-example-multiple-linear-regression.html"><a href="real-data-example-multiple-linear-regression.html"><i class="fa fa-check"></i><b>4</b> Real data example (Multiple linear regression)</a></li>
<li class="chapter" data-level="5" data-path="bootstrapping.html"><a href="bootstrapping.html"><i class="fa fa-check"></i><b>5</b> Bootstrapping</a><ul>
<li class="chapter" data-level="5.1" data-path="bootstrapping.html"><a href="bootstrapping.html#warning"><i class="fa fa-check"></i><b>5.1</b> Warning</a></li>
<li class="chapter" data-level="5.2" data-path="bootstrapping.html"><a href="bootstrapping.html#introduction"><i class="fa fa-check"></i><b>5.2</b> Introduction</a></li>
<li class="chapter" data-level="5.3" data-path="bootstrapping.html"><a href="bootstrapping.html#normal-distribution-sd-se"><i class="fa fa-check"></i><b>5.3</b> Normal distribution, SD, SE</a></li>
<li class="chapter" data-level="5.4" data-path="bootstrapping.html"><a href="bootstrapping.html#sample-function"><i class="fa fa-check"></i><b>5.4</b> Sample function</a></li>
<li class="chapter" data-level="5.5" data-path="bootstrapping.html"><a href="bootstrapping.html#proportion"><i class="fa fa-check"></i><b>5.5</b> Proportion</a></li>
<li class="chapter" data-level="5.6" data-path="bootstrapping.html"><a href="bootstrapping.html#boot-package"><i class="fa fa-check"></i><b>5.6</b> boot package</a></li>
<li class="chapter" data-level="5.7" data-path="bootstrapping.html"><a href="bootstrapping.html#concept-of-percentile"><i class="fa fa-check"></i><b>5.7</b> Concept of Percentile</a></li>
<li class="chapter" data-level="5.8" data-path="bootstrapping.html"><a href="bootstrapping.html#bootstrapping-for-correlation-interval"><i class="fa fa-check"></i><b>5.8</b> Bootstrapping for correlation interval</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="poisson-regression.html"><a href="poisson-regression.html"><i class="fa fa-check"></i><b>6</b> Poisson Regression</a><ul>
<li class="chapter" data-level="6.1" data-path="poisson-regression.html"><a href="poisson-regression.html#basic-idea"><i class="fa fa-check"></i><b>6.1</b> Basic idea</a></li>
<li class="chapter" data-level="6.2" data-path="poisson-regression.html"><a href="poisson-regression.html#trying-to-understand"><i class="fa fa-check"></i><b>6.2</b> Trying to understand</a></li>
<li class="chapter" data-level="6.3" data-path="poisson-regression.html"><a href="poisson-regression.html#deviance"><i class="fa fa-check"></i><b>6.3</b> Deviance</a></li>
<li class="chapter" data-level="6.4" data-path="poisson-regression.html"><a href="poisson-regression.html#overdispersion-using-another-example"><i class="fa fa-check"></i><b>6.4</b> Overdispersion (using another example)</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="use-r-for-mediation.html"><a href="use-r-for-mediation.html"><i class="fa fa-check"></i><b>7</b> Use R for mediation</a><ul>
<li class="chapter" data-level="7.1" data-path="use-r-for-mediation.html"><a href="use-r-for-mediation.html#normal-distribution-case"><i class="fa fa-check"></i><b>7.1</b> Normal Distribution Case</a></li>
<li class="chapter" data-level="7.2" data-path="use-r-for-mediation.html"><a href="use-r-for-mediation.html#poisson-distribution-case"><i class="fa fa-check"></i><b>7.2</b> Poisson Distribution Case</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://williamdingpullman.github.io/" target="blank">Bill's State Notes</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">SEM and R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="use-r-for-mediation" class="section level1">
<h1><span class="header-section-number">Chapter 7</span> Use R for mediation</h1>
<p>References:</p>
<p><a href="https://bookdown.org/roback/bookdown-BeyondMLR/ch-poissonreg.html" class="uri">https://bookdown.org/roback/bookdown-BeyondMLR/ch-poissonreg.html</a></p>
<p><a href="https://advstats.psychstat.org/book/mediation/index.php" class="uri">https://advstats.psychstat.org/book/mediation/index.php</a></p>
<div id="normal-distribution-case" class="section level2">
<h2><span class="header-section-number">7.1</span> Normal Distribution Case</h2>
<p>The following code generates the data to be used in the mediation model. Based on the histogram, we can see that it follows Poisson distribution.</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb105-1" title="1"><span class="co"># Generate data for mediation analysis</span></a>
<a class="sourceLine" id="cb105-2" title="2"><span class="co"># https://ademos.people.uic.edu/Chapter14.html</span></a>
<a class="sourceLine" id="cb105-3" title="3"></a>
<a class="sourceLine" id="cb105-4" title="4"><span class="co"># Generate Possion data</span></a>
<a class="sourceLine" id="cb105-5" title="5"><span class="co"># https://stats.stackexchange.com/questions/27443/generate-data-samples-from-poisson-regression</span></a>
<a class="sourceLine" id="cb105-6" title="6"></a>
<a class="sourceLine" id="cb105-7" title="7"><span class="kw">set.seed</span>(<span class="dv">123</span>) </a>
<a class="sourceLine" id="cb105-8" title="8">N &lt;-<span class="st"> </span><span class="dv">200</span> </a>
<a class="sourceLine" id="cb105-9" title="9">X &lt;-<span class="st"> </span><span class="kw">rnorm</span>(N, <span class="dv">1</span>, <span class="dv">1</span>)   </a>
<a class="sourceLine" id="cb105-10" title="10">M &lt;-<span class="st"> </span><span class="fl">0.6</span><span class="op">*</span>X <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(N, <span class="dv">0</span>, <span class="dv">1</span>) </a>
<a class="sourceLine" id="cb105-11" title="11">mu &lt;-<span class="st"> </span><span class="kw">exp</span>(<span class="fl">0.2</span><span class="op">*</span>X<span class="fl">+0.8</span><span class="op">*</span>M ) </a>
<a class="sourceLine" id="cb105-12" title="12">Y &lt;-<span class="st"> </span><span class="kw">rpois</span>(<span class="dt">n=</span>N, <span class="dt">lambda=</span>mu)</a>
<a class="sourceLine" id="cb105-13" title="13"></a>
<a class="sourceLine" id="cb105-14" title="14">Test_data &lt;-<span class="st"> </span><span class="kw">data.frame</span>(X, M, Y)</a>
<a class="sourceLine" id="cb105-15" title="15"></a>
<a class="sourceLine" id="cb105-16" title="16"><span class="kw">head</span>(Test_data)</a></code></pre></div>
<pre><code>##           X         M Y
## 1 0.4395244 2.4625250 7
## 2 0.7698225 1.7743065 4
## 3 2.5587083 1.2700799 2
## 4 1.0705084 1.1854991 1
## 5 1.1292877 0.2632327 1
## 6 2.7150650 1.1527921 9</code></pre>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb107-1" title="1"><span class="kw">hist</span>(Test_data<span class="op">$</span>Y)</a></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-32-1.png" width="672" /></p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb108-1" title="1"><span class="co"># write.csv(Test_data,&quot;Test_data.csv&quot;)</span></a></code></pre></div>
<p>Next, while in reality it follows Poisson distribution, the following assumes normal distribution. You will find the results are consistent with PROCESS.</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb109-1" title="1">Normal_Mediation&lt;-<span class="cf">function</span>(X, M, Y, data_used, <span class="dt">resampling_size=</span><span class="dv">5000</span>)</a>
<a class="sourceLine" id="cb109-2" title="2"></a>
<a class="sourceLine" id="cb109-3" title="3">  {</a>
<a class="sourceLine" id="cb109-4" title="4"></a>
<a class="sourceLine" id="cb109-5" title="5">  result =<span class="st"> </span><span class="kw">rep</span>(<span class="ot">NA</span>, resampling_size)</a>
<a class="sourceLine" id="cb109-6" title="6">  n_row =<span class="st"> </span><span class="kw">nrow</span>(data_used)</a>
<a class="sourceLine" id="cb109-7" title="7">  </a>
<a class="sourceLine" id="cb109-8" title="8">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>resampling_size)</a>
<a class="sourceLine" id="cb109-9" title="9">  {</a>
<a class="sourceLine" id="cb109-10" title="10">  boot.sample =<span class="st"> </span><span class="kw">sample</span>(n_row, <span class="dt">replace =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb109-11" title="11">  data_temp&lt;-data_used[boot.sample,]</a>
<a class="sourceLine" id="cb109-12" title="12">  </a>
<a class="sourceLine" id="cb109-13" title="13">  <span class="co"># a path</span></a>
<a class="sourceLine" id="cb109-14" title="14">  result_a_temp&lt;-<span class="kw">lm</span>(M<span class="op">~</span>X, <span class="dt">data =</span> data_temp)<span class="op">$</span>coefficients</a>
<a class="sourceLine" id="cb109-15" title="15">  <span class="kw">names</span>(result_a_temp) &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb109-16" title="16">  a_<span class="dv">0</span>_temp&lt;-result_a_temp[<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb109-17" title="17">  a_<span class="dv">1</span>_temp&lt;-result_a_temp[<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb109-18" title="18">  </a>
<a class="sourceLine" id="cb109-19" title="19">  <span class="co"># b path</span></a>
<a class="sourceLine" id="cb109-20" title="20">  result_b_temp&lt;-<span class="kw">lm</span>(Y<span class="op">~</span>M<span class="op">+</span>X, <span class="dt">data =</span> data_temp)<span class="op">$</span>coefficients</a>
<a class="sourceLine" id="cb109-21" title="21">  <span class="kw">names</span>(result_b_temp) &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb109-22" title="22">  b_<span class="dv">0</span>_temp&lt;-result_b_temp[<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb109-23" title="23">  b_<span class="dv">1</span>_temp&lt;-result_b_temp[<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb109-24" title="24">  c_<span class="dv">1</span>_apostrophe_temp&lt;-result_b_temp[<span class="dv">3</span>]</a>
<a class="sourceLine" id="cb109-25" title="25">  </a>
<a class="sourceLine" id="cb109-26" title="26">  <span class="co">#calculating the indirect effect</span></a>
<a class="sourceLine" id="cb109-27" title="27">  indirect_temp&lt;-a_<span class="dv">1</span>_temp<span class="op">*</span>b_<span class="dv">1</span>_temp</a>
<a class="sourceLine" id="cb109-28" title="28">  result[i]=indirect_temp</a>
<a class="sourceLine" id="cb109-29" title="29">  }</a>
<a class="sourceLine" id="cb109-30" title="30"></a>
<a class="sourceLine" id="cb109-31" title="31">  <span class="kw">hist</span>(result)</a>
<a class="sourceLine" id="cb109-32" title="32">  <span class="kw">sd</span>(result)</a>
<a class="sourceLine" id="cb109-33" title="33"></a>
<a class="sourceLine" id="cb109-34" title="34">  <span class="kw">print</span>(<span class="kw">mean</span>(result) <span class="op">+</span><span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>) <span class="op">*</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span><span class="kw">sd</span>(result))</a>
<a class="sourceLine" id="cb109-35" title="35">   <span class="kw">print</span>(<span class="kw">quantile</span>(result,<span class="kw">c</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>)))</a>
<a class="sourceLine" id="cb109-36" title="36"></a>
<a class="sourceLine" id="cb109-37" title="37">}</a>
<a class="sourceLine" id="cb109-38" title="38"></a>
<a class="sourceLine" id="cb109-39" title="39"><span class="kw">Normal_Mediation</span>(<span class="dt">X=</span>X, <span class="dt">M=</span>M,<span class="dt">Y=</span>Y, <span class="dt">data_used =</span> Test_data,<span class="dt">resampling_size=</span><span class="dv">5000</span>)</a></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-33-1.png" width="672" /></p>
<pre><code>## [1] 0.9502475 2.4221161
##     2.5%    97.5% 
## 1.021319 2.453762</code></pre>
</div>
<div id="poisson-distribution-case" class="section level2">
<h2><span class="header-section-number">7.2</span> Poisson Distribution Case</h2>
<p>However, the problem is that the DV is count data. So, it is better to take that into consideration. The following is based on the paper of Geldhof 2017, Accommodating binary and count variables in mediation, A case for conditional indirect effects.</p>
<p>In particular,</p>
<p>Poisson regression uses the log link. For the b path function, it is as follows.</p>
<p><span class="math display">\[log(Y)=e^{b_0+b_1M+c^{&#39;}X}\]</span></p>
<p>Thus, its first partial derivative again M is as follows.</p>
<p><span class="math display">\[b_1e^{b_0+b_1M+c^{&#39;}X}\]</span>
Where,</p>
<p><span class="math display">\[M=a_0+a_1X\]</span></p>
<p>Thus, the indirect effect is as follows.</p>
<p><span class="math display">\[IndirectEffect = a_1b_1e^{b_0+b_1M+c^{&#39;}X}=a_1b_1e^{b_0+b_1(a_0+a_1X)+c^{&#39;}X}\]</span></p>
<p>As we can see the indirect effect is not a constant, as it depends on X. Different X values will lead to different indirect effects. Thus, you can see the following R code takes this into consideration.</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb111-1" title="1"><span class="co"># x_predetermined = 0 : X = Mean</span></a>
<a class="sourceLine" id="cb111-2" title="2"><span class="co"># x_predetermined = 1 : X = Mean + SD</span></a>
<a class="sourceLine" id="cb111-3" title="3"><span class="co"># x_predetermined = -1 : X = Mean - SD</span></a>
<a class="sourceLine" id="cb111-4" title="4"></a>
<a class="sourceLine" id="cb111-5" title="5">Poisson_Mediation&lt;-<span class="cf">function</span>(X, M, Y, data_used, <span class="dt">x_predetermined=</span><span class="dv">0</span>, <span class="dt">resampling_size=</span><span class="dv">5000</span>) </a>
<a class="sourceLine" id="cb111-6" title="6">{</a>
<a class="sourceLine" id="cb111-7" title="7">  </a>
<a class="sourceLine" id="cb111-8" title="8">    result =<span class="st"> </span><span class="kw">rep</span>(<span class="ot">NA</span>, resampling_size)</a>
<a class="sourceLine" id="cb111-9" title="9">    n_row =<span class="st"> </span><span class="kw">nrow</span>(data_used)</a>
<a class="sourceLine" id="cb111-10" title="10">    </a>
<a class="sourceLine" id="cb111-11" title="11">    </a>
<a class="sourceLine" id="cb111-12" title="12">    <span class="cf">if</span>(x_predetermined<span class="op">==</span><span class="dv">0</span>){x_predetermined=<span class="kw">mean</span>(data_used<span class="op">$</span>X)}</a>
<a class="sourceLine" id="cb111-13" title="13">    <span class="cf">else</span> <span class="cf">if</span> (x_predetermined<span class="op">==-</span><span class="dv">1</span>){x_predetermined=<span class="kw">mean</span>(data_used<span class="op">$</span>X)<span class="op">-</span><span class="kw">sd</span>(data_used<span class="op">$</span>X)}</a>
<a class="sourceLine" id="cb111-14" title="14">    <span class="cf">else</span>(<span class="dt">x_predetermined=</span><span class="kw">mean</span>(data_used<span class="op">$</span>X)<span class="op">+</span><span class="kw">sd</span>(data_used<span class="op">$</span>X))</a>
<a class="sourceLine" id="cb111-15" title="15"></a>
<a class="sourceLine" id="cb111-16" title="16"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>resampling_size)</a>
<a class="sourceLine" id="cb111-17" title="17">{</a>
<a class="sourceLine" id="cb111-18" title="18">  boot.sample =<span class="st"> </span><span class="kw">sample</span>(n_row, <span class="dt">replace =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb111-19" title="19">  data_temp&lt;-data_used[boot.sample,]</a>
<a class="sourceLine" id="cb111-20" title="20">  </a>
<a class="sourceLine" id="cb111-21" title="21">  <span class="co"># a path</span></a>
<a class="sourceLine" id="cb111-22" title="22">  result_a_temp&lt;-<span class="kw">lm</span>(M<span class="op">~</span>X, <span class="dt">data =</span> data_temp)<span class="op">$</span>coefficients</a>
<a class="sourceLine" id="cb111-23" title="23">  <span class="kw">names</span>(result_a_temp) &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb111-24" title="24">  a_<span class="dv">0</span>_temp&lt;-result_a_temp[<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb111-25" title="25">  a_<span class="dv">1</span>_temp&lt;-result_a_temp[<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb111-26" title="26">  </a>
<a class="sourceLine" id="cb111-27" title="27">  <span class="co"># b path</span></a>
<a class="sourceLine" id="cb111-28" title="28">  result_b_temp&lt;-<span class="kw">glm</span>(Y<span class="op">~</span>M<span class="op">+</span>X, <span class="dt">data =</span> data_temp, <span class="dt">family =</span> quasipoisson)<span class="op">$</span>coefficients</a>
<a class="sourceLine" id="cb111-29" title="29">  <span class="kw">names</span>(result_b_temp) &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb111-30" title="30">  b_<span class="dv">0</span>_temp&lt;-result_b_temp[<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb111-31" title="31">  b_<span class="dv">1</span>_temp&lt;-result_b_temp[<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb111-32" title="32">  c_<span class="dv">1</span>_apostrophe_temp&lt;-result_b_temp[<span class="dv">3</span>]</a>
<a class="sourceLine" id="cb111-33" title="33">  </a>
<a class="sourceLine" id="cb111-34" title="34">  <span class="co">#calculating the indirect effect</span></a>
<a class="sourceLine" id="cb111-35" title="35">  </a>
<a class="sourceLine" id="cb111-36" title="36">  M_estimated_temp=a_<span class="dv">0</span>_temp<span class="op">+</span>a_<span class="dv">1</span>_temp<span class="op">*</span>x_predetermined</a>
<a class="sourceLine" id="cb111-37" title="37">  indirect_temp&lt;-a_<span class="dv">1</span>_temp<span class="op">*</span>b_<span class="dv">1</span>_temp<span class="op">*</span><span class="kw">exp</span>(b_<span class="dv">0</span>_temp<span class="op">+</span>b_<span class="dv">1</span>_temp<span class="op">*</span>M_estimated_temp<span class="op">+</span>c_<span class="dv">1</span>_apostrophe_temp<span class="op">*</span>x_predetermined)</a>
<a class="sourceLine" id="cb111-38" title="38">  result[i]=indirect_temp</a>
<a class="sourceLine" id="cb111-39" title="39">}</a>
<a class="sourceLine" id="cb111-40" title="40"><span class="kw">hist</span>(result)</a>
<a class="sourceLine" id="cb111-41" title="41"><span class="kw">quantile</span>(result,<span class="kw">c</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>))</a>
<a class="sourceLine" id="cb111-42" title="42">}</a>
<a class="sourceLine" id="cb111-43" title="43"></a>
<a class="sourceLine" id="cb111-44" title="44"><span class="co"># X = Mean</span></a>
<a class="sourceLine" id="cb111-45" title="45"><span class="kw">Poisson_Mediation</span>(<span class="dt">X=</span>X, <span class="dt">M=</span>M,<span class="dt">Y=</span>Y, <span class="dt">data_used =</span> Test_data,<span class="dt">x_predetermined=</span><span class="dv">0</span>,<span class="dt">resampling_size=</span><span class="dv">5000</span>)</a></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-34-1.png" width="672" /></p>
<pre><code>##      2.5%     97.5% 
## 0.6432712 1.2018952</code></pre>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb113-1" title="1"><span class="co"># X = Mean - 1 SD</span></a>
<a class="sourceLine" id="cb113-2" title="2"><span class="kw">Poisson_Mediation</span>(<span class="dt">X=</span>X, <span class="dt">M=</span>M,<span class="dt">Y=</span>Y, <span class="dt">data_used =</span> Test_data,<span class="dt">x_predetermined=</span><span class="op">-</span><span class="dv">1</span>,<span class="dt">resampling_size=</span><span class="dv">5000</span>)</a></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-34-2.png" width="672" /></p>
<pre><code>##      2.5%     97.5% 
## 0.3773349 0.6186202</code></pre>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb115-1" title="1"><span class="co"># X = Mean + 1 SD</span></a>
<a class="sourceLine" id="cb115-2" title="2"><span class="kw">Poisson_Mediation</span>(<span class="dt">X=</span>X, <span class="dt">M=</span>M,<span class="dt">Y=</span>Y, <span class="dt">data_used =</span> Test_data,<span class="dt">x_predetermined=</span><span class="dv">1</span>,<span class="dt">resampling_size=</span><span class="dv">5000</span>)</a></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-34-3.png" width="672" /></p>
<pre><code>##     2.5%    97.5% 
## 1.073396 2.435226</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="poisson-regression.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["bookdown-demo.pdf", "bookdown-demo.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
